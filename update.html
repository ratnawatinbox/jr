<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Update Employee Details</title>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    input {
      width: 250px;
      padding: 6px;
    }
    button {
      padding: 8px 15px;
      margin-top: 10px;
    }
    #loginBtn {
      background: #007bff;
      color: white;
      border: none;
      display: none;
    }
    #updateBtn:disabled {
      background: gray;
      cursor: not-allowed;
    }
  </style>
</head>

<body>

  <h2>Update Your Details</h2>

  <form id="updateForm">

    Employee ID (Locked):<br>
    <input type="text" id="employeeId" readonly><br><br>

    Name:<br>
    <input type="text" id="employeeName"><br><br>

    Father's Name:<br>
    <input type="text" id="fatherName"><br><br>

    Address:<br>
    <input type="text" id="address"><br><br>

    City:<br>
    <input type="text" id="city"><br><br>

    Mobile:<br>
    <input type="text" id="mobile"><br><br>

    Email:<br>
    <input type="email" id="email"><br><br>

    Date of Birth:<br>
    <input type="date" id="dob"><br><br>

    Date of Joining:<br>
    <input type="date" id="doj"><br><br>

    PAN:<br>
    <input type="text" id="pan"><br><br>

    <button type="button" id="updateBtn" onclick="updateData()">Update</button>
    <button type="button" id="loginBtn" onclick="goToLogin()">Login</button>

  </form>

  <p id="status"></p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyvZKfnHtuohINwsyWuHw4-DszHZ5jWjV8WokVblgdl76VwX6Hj2XqAkIKuW3u4GFP-/exec";

    // Load employee data automatically
    window.onload = function () {
      const empId = localStorage.getItem("employeeId");
      if (!empId) {
        document.getElementById("status").innerText = "No login session found.";
        return;
      }

      fetch(scriptURL + "?action=getEmployee&employeeId=" + empId)
        .then(res => res.json())
        .then(data => {
          Object.keys(data).forEach(key => {
            if (document.getElementById(key)) {
              document.getElementById(key).value = data[key] || "";
            }
          });
        });
    };

    // Update employee data
    function updateData() {
      let form = document.getElementById("updateForm");
      let formData = new FormData(form);

      let query = "?action=updateEmployee";
      formData.forEach((value, key) => {
        query += "&" + key + "=" + encodeURIComponent(value);
      });

      fetch(scriptURL + query)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.getElementById("status").innerText = "Updated successfully!";

            // Disable update button
            document.getElementById("updateBtn").disabled = true;

            // Show login button
            document.getElementById("loginBtn").style.display = "inline-block";

            // Clear login session
            localStorage.removeItem("employeeId");
          } else {
            document.getElementById("status").innerText = "Update failed!";
          }
        });
    }

    // Go to login page
    function goToLogin() {
      window.location.href = "index.html"; // Change if your login file name is different
    }
  </script>

</body>
</html>