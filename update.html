<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Update Employee Details</title>
</head>
<body>
  <h2>Update Your Details</h2>

  <form id="updateForm">

    Employee ID (Locked):<br>
    <input type="text" id="employeeId" readonly><br><br>

    Name:<br>
    <input type="text" id="employeeName"><br><br>

    Father's Name:<br>
    <input type="text" id="fatherName"><br><br>

    Address:<br>
    <input type="text" id="address"><br><br>

    City:<br>
    <input type="text" id="city"><br><br>

    Mobile:<br>
    <input type="text" id="mobile"><br><br>

    Email:<br>
    <input type="email" id="email"><br><br>

    Date of Birth:<br>
    <input type="date" id="dob"><br><br>

    Date of Joining:<br>
    <input type="date" id="doj"><br><br>

    PAN:<br>
    <input type="text" id="pan"><br><br>

    <button type="button" onclick="updateData()">Update</button>
  </form>

  <p id="status"></p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyvZKfnHtuohINwsyWuHw4-DszHZ5jWjV8WokVblgdl76VwX6Hj2XqAkIKuW3u4GFP-/exec";

    // Load employee data automatically
    window.onload = function () {
      const empId = localStorage.getItem("employeeId");
      if (!empId) {
        document.getElementById("status").innerText = "No login session found.";
        return;
      }

      fetch(scriptURL + "?action=getEmployee&employeeId=" + empId)
        .then(res => res.json())
        .then(data => {
          document.getElementById("employeeId").value = data.employeeId || "";
          document.getElementById("employeeName").value = data.employeeName || "";
          document.getElementById("fatherName").value = data.fatherName || "";
          document.getElementById("address").value = data.address || "";
          document.getElementById("city").value = data.city || "";
          document.getElementById("mobile").value = data.mobile || "";
          document.getElementById("email").value = data.email || "";
          document.getElementById("dob").value = data.dob || "";
          document.getElementById("doj").value = data.doj || "";
          document.getElementById("pan").value = data.pan || "";
        });
    };

    // Update employee data
    function updateData() {
      let form = document.getElementById("updateForm");
      let formData = new FormData(form);

      let query = "?action=updateEmployee";
      formData.forEach((value, key) => {
        query += "&" + key + "=" + encodeURIComponent(value);
      });

      fetch(scriptURL + query)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.getElementById("status").innerText = "Updated successfully!";
          } else {
            document.getElementById("status").innerText = "Update failed!";
          }
        });
    }
  </script>

</body>
</html>