<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Update Employee Details</title>
</head>
<body>
  <h2>Update Your Details</h2>

  <form id="updateForm">

    Employee ID (Locked):<br>
    <input type="text" id="employeeId" name="employeeId" readonly><br><br>

    Name:<br>
    <input type="text" id="employeeName" name="employeeName"><br><br>

    Father's Name:<br>
    <input type="text" id="fatherName" name="fatherName"><br><br>

    Address:<br>
    <input type="text" id="address" name="address"><br><br>

    City:<br>
    <input type="text" id="city" name="city"><br><br>

    Mobile:<br>
    <input type="text" id="mobile" name="mobile"><br><br>

    Email:<br>
    <input type="email" id="email" name="email"><br><br>

    Date of Birth:<br>
    <input type="date" id="dob" name="dob"><br><br>

    Date of Joining:<br>
    <input type="date" id="doj" name="doj"><br><br>

    PAN:<br>
    <input type="text" id="pan" name="pan"><br><br>

    DWP (Password):<br>
    <input type="text" id="dwp" name="dwp"><br><br>

    <button type="button" onclick="updateData()">Update</button>
  </form>

  <p id="status"></p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyvZKfnHtuohINwsyWuHw4-DszHZ5jWjV8WokVblgdl76VwX6Hj2XqAkIKuW3u4GFP-/exec";

    // Auto-load employee data
    window.onload = function () {
      const empId = localStorage.getItem("employeeId");

      if (!empId) {
        document.getElementById("status").innerText = "No login session found.";
        return;
      }

      fetch(scriptURL + "?action=getEmployee&employeeId=" + empId)
        .then(res => res.json())
        .then(data => {
          Object.keys(data).forEach(key => {
            if (document.getElementById(key)) {
              document.getElementById(key).value = data[key] || "";
            }
          });
        });
    };

    // Update data
    function updateData() {
      let form = document.getElementById("updateForm");
      let formData = new FormData(form);

      let query = "?action=updateEmployee";
      formData.forEach((value, key) => {
        query += "&" + key + "=" + encodeURIComponent(value);
      });

      fetch(scriptURL + query)
        .then(res => res.json())
        .then(data => {
          document.getElementById("status").innerText =
            data.success ? "Updated successfully!" : "Update failed!";
        });
    }
  </script>

</body>
</html>